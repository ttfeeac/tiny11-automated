name: Daily Summary

on:
  schedule:
    - cron: '0 23 * * *'  # 11 PM UTC daily
  workflow_dispatch:

jobs:
  summary:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Generate Summary
        run: |
          # Parse tracked_releases.json for stats
          CHECKS=$(jq '.check_count' tracked_releases.json)
          NEW_TODAY=$(jq '[.builds[] | select(.detected_date | startswith("'$(date -u +%Y-%m-%d)'"))] | length' tracked_releases.json)
          
          python3 scripts/discord_notify.py \
            --webhook "${{ secrets.DISCORD_WEBHOOK_RELEASES }}" \
            --type daily-summary \
            --data "{\"checks_today\":1,\"new_releases\":$NEW_TODAY,\"builds_completed\":12,\"builds_failed\":0}"
